<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="color-scheme" content="light dark">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&display=swap" rel="stylesheet">

<style>
    :root {
        --capa-base: #151515;
        --prata: #e0e0e0;
        --papel: #fdf6e3;
        --fita: #8b0000;
        --leather-tex: url('https://www.transparenttextures.com/patterns/dark-leather.png');
        --corner-url: url('https://i.imgur.com/eKnNgYK.png');
    }

    body, html {
        margin: 0; padding: 0;
        width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        background: transparent !important; 
        font-family: 'Georgia', serif;
        overflow: hidden;
    }

    #scaleWrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 300px;
        height: 500px;
        transform-origin: center center;
        transition: transform 0.1s linear; 
    }

    .viewport {
        width: 500px;
        height: 500px;
        perspective: 1500px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }

    .book {
        width: 260px;
        height: 360px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        transform: rotateY(-20deg);
        transform-origin: right center;
    }

    .book.open {
        transform: rotateY(0deg) translateX(40%);
    }

    .spine {
        position: absolute;
        left: -24px; top: 0;
        width: 26px; height: 100%;
        background: var(--capa-base);
        background-image: var(--leather-tex);
        transform: rotateY(-90deg);
        transform-origin: right;
        box-shadow: inset -5px 0 10px rgba(0,0,0,0.5);
    }

    .book-back {
        position: absolute;
        width: 104.5%; height: 100%;
        background: var(--capa-base);
        background-image: var(--leather-tex);
        border-radius: 0 5px 5px 0;
        transform: translateZ(-10px); 
    }

    .cover {
        position: absolute;
        width: 100%; height: 100%;
        background-color: var(--capa-base);
        border-radius: 0 5px 5px 0;
        z-index: 100;
        transform-origin: left;
        transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        transform-style: preserve-3d;
        transition-delay: 0.8s; 
    }

    .book.open .cover {
        transform: rotateY(-155deg);
        transition-delay: 0s; 
    }

    .front-face-art {
        position: absolute;
        top:0; left:0; width: 100%; height: 100%;
        background-color: var(--capa-base);
        background-image: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.4) 100%), var(--leather-tex);
        border-radius: 0 5px 5px 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        backface-visibility: hidden;
        z-index: 2;
        box-shadow: inset 1px 1px 2px rgba(255,255,255,0.1), inset -2px -2px 5px rgba(0,0,0,0.5);
    }

    .spine-groove {
        position: absolute;
        left: 15px; top: 0; bottom: 0; width: 4px;
        border-left: 1px solid rgba(0,0,0,0.6);
        border-right: 1px solid rgba(255,255,255,0.1);
        background: rgba(0,0,0,0.2);
    }

    .corner-ornament {
        position: absolute;
        width: 70px; height: 70px;
        background-image: var(--corner-url);
        background-size: contain;
        background-repeat: no-repeat;
        pointer-events: none;
        z-index: 10;
        filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.8)) brightness(1.2);
    }
    .co-tr { top: -1px; right: -1px; transform: rotate(90deg); }
    .co-br { bottom: -1px; right: -1px; transform: rotate(90deg) scaleX(-1); }

    .cover-content {
        display: flex; flex-direction: column;
        align-items: center; width: 70%;
        margin-left: 15px; margin-top: 50px;
    }

    .front-face-art h1 {
        font-family: 'UnifrakturMaguntia', cursive;
        color: var(--prata);
        font-size: 1.7rem;
        text-align: center;
        font-weight: normal;
        margin: 15px 0;
        line-height: 1.1;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.9);
    }

    .divider {
        width: 160px; height: 20px;
        background-image: url('https://i.imgur.com/F0LHG3G.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        filter: brightness(1.2) grayscale(1);
        opacity: 0.9;
    }
    .divider-bottom { transform: scaleY(-1); margin-top: -5px; }
    .divider-top { margin-bottom: -5px; }

    .turning-page {
        position: absolute;
        width: 250px; height: 350px;
        top: 5px; left: 5px;
        background: var(--papel);
        transform-origin: left;
        transition: transform 1.2s cubic-bezier(0.15, 0, 0.15, 1);
        border-radius: 0 4px 4px 0;
        transform-style: preserve-3d;
    }

    .p1 { transition-delay: 0.6s; z-index: 40; }
    .p2 { transition-delay: 0.5s; z-index: 39; }
    .p3 { transition-delay: 0.4s; z-index: 38; }
    .p4 { transition-delay: 0.3s; z-index: 37; }
    .p5 { transition-delay: 0.2s; z-index: 36; }
    .p6 { transition-delay: 0.1s; z-index: 35; }

    .book.open .p1 { transform: rotateY(-150deg); transition-delay: 0.1s; }
    .book.open .p2 { transform: rotateY(-147deg); transition-delay: 0.2s; }
    .book.open .p3 { transform: rotateY(-144deg); transition-delay: 0.3s; }
    .book.open .p4 { transform: rotateY(-141deg); transition-delay: 0.4s; }
    .book.open .p5 { transform: rotateY(-138deg); transition-delay: 0.5s; }
    .book.open .p6 { transform: rotateY(-135deg); transition-delay: 0.6s; }

    .right-stack {
        position: absolute;
        width: 250px; height: 350px;
        top: 5px; left: 5px;
        background: var(--papel);
        border-radius: 0 4px 4px 0;
        z-index: 10;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        padding: 35px 20px 25px 40px;
        box-sizing: border-box;
        text-align: center;
        box-shadow: 1px 0 0 #d1c9b8, 2px 0 0 #fdf6e3, 3px 0 0 #d1c9b8, 4px 0 0 #fdf6e3, 5px 0 0 #d1c9b8, 6px 0 0 #fdf6e3, 7px 0 0 #d1c9b8, 8px 0 0 #fdf6e3, 9px 0 0 #d1c9b8, 10px 0 0 #fdf6e3, 11px 0 0 #d1c9b8, 12px 0 15px rgba(0,0,0,0.3);
    }

    .ribbon-container {
        position: absolute;
        top: 4px; left: 15px;
        width: 14px; height: 380px; 
        overflow: hidden;
        z-index: 60;
        pointer-events: none;
    }
    .ribbon {
        position: absolute; top: -380px; left: 0;
        width: 100%; height: 100%;
        background: var(--fita);
        box-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        transition: top 0.6s ease;
        pointer-events: auto; cursor: grab;
        clip-path: polygon(0 0, 100% 0, 100% 100%, 50% 97%, 0 100%);
        touch-action: none; /* Desativa gestos do navegador para melhor controle */
    }
    .book.open .ribbon { top: 0; }
    .ribbon.pulling { cursor: grabbing; transition: none; }

    #obra-titulo { font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; color: #111; }
    #obra-sinopse {
        font-size: 0.82rem;
        color: #444;
        font-style: italic;
        line-height: 1.4;
        overflow-y: auto;
        max-height: 180px;
        padding-right: 5px;
        margin: 10px 0;
        scrollbar-width: thin;
        scrollbar-color: #d1c9b8 transparent;
    }

    #obra-sinopse::-webkit-scrollbar { width: 4px; }
    #obra-sinopse::-webkit-scrollbar-thumb { background: #d1c9b8; border-radius: 10px; }
    #obra-link { margin-top: 15px; color: var(--fita); text-decoration: none; font-weight: bold; border-bottom: 1px solid; font-size: 0.85rem; display: inline-block; cursor: pointer;}
</style>
</head>
<body>

<audio id="pageFlipSound" preload="auto">
    <source src="https://github.com/rayarchive/sounds/raw/refs/heads/main/flip%20page.mp3" type="audio/mpeg">
</audio>

<div id="scaleWrapper">
    <div class="viewport">
        <div class="book" id="book">
            <div class="spine"></div>
            <div class="book-back"></div>

            <div class="cover" onclick="toggleBook()">
                <div class="front-face-art">
                    <div class="spine-groove"></div>
                    <div class="corner-ornament co-tr"></div>
                    <div class="corner-ornament co-br"></div>
                    
                    <div class="cover-content">
                        <div class="divider divider-top"></div>
                        <h1>Mana i entulë<br>nómë?</h1>
                        <div class="divider divider-bottom"></div>
                    </div>
                </div>
            </div>

            <div class="turning-page p1" onclick="closeBook()"></div>
            <div class="turning-page p2" onclick="closeBook()"></div>
            <div class="turning-page p3" onclick="closeBook()"></div>
            <div class="turning-page p4" onclick="closeBook()"></div>
            <div class="turning-page p5" onclick="closeBook()"></div>
            <div class="turning-page p6" onclick="closeBook()"></div>

            <div class="right-stack">
                <div id="obra-titulo"></div>
                <div id="obra-sinopse"></div>
                <a id="obra-link" target="_blank">Ler Obra →</a>
            </div>

            <div class="ribbon-container">
                <div class="ribbon" id="ribbon"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const obras = [
        { titulo: "Dom Casmurro", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://panini.com.br/kusuriya-no-hitorigoto-diarios-de-uma-apotecaria-01?srsltid=AfmBOopJBx_xLPE_CVfeoEyd2W_qoy_CBzGoTYQ6oepvDsRBbGeVtHw8" },
        { titulo: "O Alienista", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://codepen.io/pen/?editors=1000" },
        { titulo: "Diarios de uma apotecaria", sinopse:"Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://github.com/rayarchive/Sorteio-Livro/tree/main" },
        { titulo: "Iracema", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://www.notion.so/Widgets-2e4d0c17411c802c9c58fab52e5bcbd7" }
    ];

    let aberto = false;
    let sorteando = false;
    let currentScale = 1;
    const book = document.getElementById('book');
    const ribbon = document.getElementById('ribbon');
    const wrapper = document.getElementById('scaleWrapper');
    const audio = document.getElementById('pageFlipSound');

    function playSound() {
        audio.volume = 0.3; 
        audio.playbackRate = 1.5;
        audio.currentTime = 0; 
        audio.play().catch(e => console.log("Interação necessária."));
    }

    function resizeBook() {
        const winW = window.innerWidth;
        const winH = window.innerHeight;
        const refWidth = (winW < 500) ? 320 : 500;
        const refHeight = 500;
        currentScale = Math.min(winW / refWidth, winH / refHeight);
        if (currentScale > 1.3) currentScale = 1.3;
        wrapper.style.transform = `scale(${currentScale})`;
    }

    window.addEventListener('resize', resizeBook);
    window.addEventListener('load', resizeBook);

    function carregarObraAleatoria() {
        const random = obras[Math.floor(Math.random() * obras.length)];
        document.getElementById('obra-titulo').innerText = random.titulo;
        document.getElementById('obra-sinopse').innerText = random.sinopse;
        document.getElementById('obra-link').href = random.link;
    }
    carregarObraAleatoria();

    function toggleBook() {
        if (!aberto) {
            aberto = true;
            book.classList.add('open');
            playSound(); 
        } else {
            closeBook();
        }
    }

    function closeBook() {
        if (aberto) {
            aberto = false;
            book.classList.remove('open');
            playSound(); 
        }
    }

    let startY = 0;
    let isPulling = false;
    const baseRibbonHeight = 380;

    const startPull = (e) => {
        if (!aberto || sorteando) return;
        e.preventDefault(); // Previne comportamentos padrão do navegador
        isPulling = true;
        startY = (e.touches ? e.touches[0].clientY : e.clientY);
        ribbon.classList.add('pulling');
    };

    const pull = (e) => {
        if (!isPulling) return;
        e.preventDefault(); // Previne scroll durante o arrasto
        let currentY = (e.touches ? e.touches[0].clientY : e.clientY);
        let deltaY = (currentY - startY) / currentScale; 

        if (deltaY > 0) {
            let move = Math.min(deltaY, 100);
            ribbon.style.height = `${baseRibbonHeight + move}px`;
            if (deltaY > 70) {
                isPulling = false;
                sortear();
            }
        }
    };

    const endPull = () => {
        if (isPulling) {
            isPulling = false;
            ribbon.classList.remove('pulling');
            ribbon.style.height = `${baseRibbonHeight}px`;
        }
    };

    // Eventos para desktop (mouse)
    ribbon.addEventListener('mousedown', startPull);
    document.addEventListener('mousemove', pull);
    document.addEventListener('mouseup', endPull);
    
    // Eventos para mobile (touch) - com passive: false para permitir preventDefault
    ribbon.addEventListener('touchstart', startPull, {passive: false});
    document.addEventListener('touchmove', pull, {passive: false});
    document.addEventListener('touchend', endPull);
    document.addEventListener('touchcancel', endPull); // Adiciona tratamento para quando o toque é cancelado

    function sortear() {
        sorteando = true;
        ribbon.style.height = `${baseRibbonHeight + 40}px`;
        const t = document.getElementById('obra-titulo');
        const s = document.getElementById('obra-sinopse');
        let i = 0;
        const interval = setInterval(() => {
            let random = obras[Math.floor(Math.random() * obras.length)];
            t.innerText = random.titulo;
            s.innerText = "...";
            i++;
            if (i > 8) {
                clearInterval(interval);
                carregarObraAleatoria();
                sorteando = false;
                ribbon.style.height = `${baseRibbonHeight}px`;
            }
        }, 100);
    }
</script>
</body>
</html>
